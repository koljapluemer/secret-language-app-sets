# Convert Data Script

## Goal

- `data/` contains human-maintained (but possibly script-generated) learning data
- `public/` should be autofilled by a script with the same data source, albeit in a different format
- this `public/` data will then be deployed on netlify and serve as a source for learning data in [linguanodon-nuxt](https://github.com/koljapluemer/linguanodon-nuxt) 

## Input

### High Level

All `data/*.json` files should be converted.

Which data is in which file is essentially meaningless — it only serves to chunk the data for human editability.

### Data Format

An example:

```json
{
    "unitsOfMeaning": {
        "a":{
            "language": "en",
            "content": "I couldn't say",
            "linguType": "sentence",
            "translations": ["b"]
        },
        "b": {
            "language": "apc",
            "content": "ما بعرفش",
            "linguType": "sentence"
        },
        "c": {
            "language": "en",
            "content": "I have a cat.",
            "linguType": "sentence",
            "translations": ["d"]
        },
        "d": {
            "language": "apc",
            "content": "عندي بسة",
            "linguType": "sentence"
        },
        "e": {
            "language": "apc",
            "content": "بسة",
            "linguType": "noun",
            "translations": ["f"]   
        },
        "f": {
            "language": "en",
            "content": "cat",
            "linguType": "noun",
            "related": ["c"]
        }
    },
    "learningGoals": {
        "a": {
            "name": "Understand 'ما بعرفش'",
            "language": "apc",
            "unitsOfMeaning": ["b"]
        },
        "b": {
            "name": "Understand 'عندي بسة'",
            "language": "apc",
            "unitsOfMeaning": ["d"]
        },
        "c": {
            "name": "Know how to translate 'cat'",
            "language": "apc",
            "unitsOfMeaning": ["e", "f"],
            "parents": ["b"]
        }
    }
}
```

## Output

### High-Level

- Should be written to `public/`, specifically to `public/learning_goals` and `public/units_of_meanings.json`
- In both of these sub-directories, a subdirectory for each unique language code ([IETF BCP 47 language tag](https://en.wikipedia.org/wiki/IETF_language_tag)) found in the data should be make
- In each of those, we want an `index.json` and then one file per learning goal/per unit of meaning

### File Format

#### Types

We want to offer the data in a format that works well with the types defined in `linguanodon-nuxt/types/persistent-general-data`

(check [this folder](https://github.com/koljapluemer/linguanodon-nuxt/tree/main/types/persistent-general-data) on GitHub)

At the moment, these are:

```ts

export interface LearningGoal {
    uid: string
    name: string
    parents: string[] // array of learning-goal uids
    blockedBy: string[] // array of learning-goal uids
    language: string // is Language.tag
    unitsOfMeaning: string[] // array of unit-of-meaning uids
    userCreated: boolean
}

export interface LearningGoalSummary {
    uid: string
    name: string
}

export interface UnitOfMeaning {
    uid: string
    language: string // references Language.tag, 
    content: string
    linguType: string
    pronunciation?: string
    notes?: string

    // note: translations and synonyms are the same thing in our context
    translations?: string[] // uids of other UnitOfMeanings
    related?: string[] // uids of other UnitOfMeanings

    
    context: string
    license?: string
    owner?:string
    ownerLink?: string
    source?:string
    sourceLink?:string
}

export interface UnitOfMeaningSummary {
    uid: string
    content: string
}
```

#### Index.json File Generation

In each per-language sub-sub directory, make an `index.json` which can be used to see all existing units of meaning / language goals. 
Its type is simply `UnitOfMeaningSummary[]`/`LearningGoalSummary[]`

#### File per Object

For each unit of meaning, and for each learning goal, create a json in the correct language sub-sub directory. Conversion notes:

- The `uid` should be generated by concating some props, then making that string URL-safe
    - For units of meaning, use `$language_$content_$linguType`
    - For learning goals, use `$language_$name`
    - If a given uid already exists, print warning in stdout
    - Each file should also be named `$uid.json`
- Note that in the input files, units of meaning and learning goals are identified by their dictionary key. This is only used to identify their relationships to each other, these keys should not make it into the output files. Note also that these dict keys of course can refer only to units of meaning within the same file, not across files.
- For all relationships, resolve them according to the used dictionary keys, and save them according to the type definitions above, using the generated `uid`.
    - Note: `UnitOfMeaning.translations` and `UnitOfMeaning.related` are automatically mutual: If in the input data *a* says that *b* is a translation of it, don't forget to also add *a* in the `translations` array of b (same for `.related`)
- Default `.context` is "unknown" 

## Notes

- Make sure the JSON is a compressed as possible (no pretty print or unneeded whitespace)